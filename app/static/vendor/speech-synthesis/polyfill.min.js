/*!
 * speech-synthesis v0.3.3
 * The MIT License
 * Copyright (c) 2014 Jan Antala <hello@janantala.com>
 */

!function(n,e){"use strict";var t=function(n,e,t){var i=[],o=function(n,s){if(e[s]&&n.trim().length)if(n.indexOf(e[s])>-1){var r=1,a=n.split(e[s]);a.forEach(function(n){if(n.length){var u="";r!=a.length&&(u=e[s]),n=(n+u).trim()}n.length&&n.length<=t?i.push(n):o(n,s+1),r++})}else o(n,s+1);else if(n.length)for(var u=new RegExp(".{1,"+t+"}","g"),d=n.match(u);d.length>0;)i.push(d.shift().trim())};o(n,0);var s=[];return i.forEach(function(n){s.length?s[s.length-1].length+n.length+1<=t?s[s.length-1]+=" "+n:s.push(n):s.push(n)}),s},i=function(n){this.isPolyfill=!0,this.text=n||"",this.lang=e.documentElement.lang||"en-US",this.volume=1,this.rate=1,this.voiceURI="native",this.pitch=1,this.onstart=void 0,this.onend=void 0,this.onerror=void 0,this.onpause=void 0,this.onresume=void 0,this.onmark=void 0,this.onboundary=void 0,this.corsProxyServer="http://www.corsproxy.com/";var i,o,s=this,r={charIndex:void 0,elapsedTime:void 0,name:void 0},a=function(){o=(new Date).getTime(),r.elapsedTime=(o-(i||o))/1e3},u=function(n,e,t){return[n,"translate.google.com/translate_tts?ie=UTF-8&q=",encodeURIComponent(e),"&tl=",t].join("")};return this._initAudio=function(){var n=[];s._ended=!1;var e=new Audio;e.addEventListener("play",function(){a(),i?s.onresume&&s.onresume(r):(i=(new Date).getTime(),s.onstart&&s.onstart(r))},!1),e.addEventListener("ended",function(){if(n.length){var t=u(s.corsProxyServer,n.shift(),s.lang);e.src=t,e.play()}else a(),s._ended=!0,s.onend&&s.onend(r)},!1),e.addEventListener("error",function(){a(),s._ended=!0,s.onerror&&s.onerror(r)},!1),e.addEventListener("pause",function(){s._ended||(a(),s.onpause&&s.onpause(r))},!1);var o=100;s.text.length>o?n=t(s.text,[".","!","?",":",";",","," "],o):n.push(s.text);var d=u(s.corsProxyServer,n.shift(),s.lang);return e.src=d,e.volume=s.volume,e.playbackRate=s.rate,e},this},o=function(){this.isPolyfill=!0,this.pending=!1,this.speaking=!1,this.paused=!1;var n=this,e=new Audio,t=[],i=function(t){var i=t.shift();n.speaking=!1,n.pending=t.length?!0:!1,i&&(e=i._initAudio(),o(e,i),u())},o=function(n,e){n.addEventListener("play",function(){},!1),n.addEventListener("ended",function(){e._ended&&i(t)},!1),n.addEventListener("error",function(){i(t)},!1),n.addEventListener("pause",function(){},!1)},s=function(e){n.pending=!0,t.push(e),n.speaking||n.paused||i(t)},r=function(){e.src="",e=void 0,e=new Audio,n.pending=!1,n.speaking=!1,n.paused=!1,t=[],i(t)},a=function(){e.pause(),n.speaking=!1,n.paused=!0},u=function(){e.src?(e.play(),n.speaking=!0):i(t),n.paused=!1},d=function(){return[]};return{isPolyfill:!0,pending:n.pending,speaking:n.speaking,paused:n.paused,speak:function(n){s(n)},cancel:function(){r()},pause:function(){a()},resume:function(){u()},getVoices:function(){d()}}};n.SpeechSynthesisUtterancePolyfill=i,n.speechSynthesisPolyfill=new o}(window,document);